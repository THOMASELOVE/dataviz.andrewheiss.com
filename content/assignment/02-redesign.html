---
title: "Redesign 2: Rats of New York"
date: "2017-10-03"
---

<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #ffffff; color: #1f1c1b; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #ffffff; color: #a0a0a0; border-right: 1px solid #a0a0a0; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #1f1c1b; background-color: #ffffff; }
code > span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code > span.dt { color: #0057ae; } /* DataType */
code > span.dv { color: #b08000; } /* DecVal */
code > span.bn { color: #b08000; } /* BaseN */
code > span.fl { color: #b08000; } /* Float */
code > span.cn { color: #aa5500; } /* Constant */
code > span.ch { color: #924c9d; } /* Char */
code > span.sc { color: #3daee9; } /* SpecialChar */
code > span.st { color: #bf0303; } /* String */
code > span.vs { color: #bf0303; } /* VerbatimString */
code > span.ss { color: #ff5500; } /* SpecialString */
code > span.im { color: #ff5500; } /* Import */
code > span.co { color: #898887; } /* Comment */
code > span.do { color: #607880; } /* Documentation */
code > span.an { color: #ca60ca; } /* Annotation */
code > span.cv { color: #0095ff; } /* CommentVar */
code > span.ot { color: #006e28; } /* Other */
code > span.fu { color: #644a9b; } /* Function */
code > span.va { color: #0057ae; } /* Variable */
code > span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code > span.op { color: #1f1c1b; } /* Operator */
code > span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code > span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code > span.pp { color: #006e28; } /* Preprocessor */
code > span.at { color: #0057ae; } /* Attribute */
code > span.re { color: #0057ae; } /* RegionMarker */
code > span.in { color: #b08000; } /* Information */
code > span.wa { color: #bf0303; } /* Warning */
code > span.al { color: #bf0303; font-weight: bold; } /* Alert */
code > span.er { color: #bf0303; text-decoration: underline; } /* Error */
code > span. { color: #1f1c1b; } /* Normal */
</style>


<p><span class="newthought">New York City is full of urban wildlife,</span> and rats are one of the city’s most infamous animal mascots. Rats in NYC are plentiful, but they also deliver food, so they’re useful too.</p>
<figure>
{{% youtube PeJUqcbool4 %}}
</figure>
<p>NYC keeps incredibly detailed data regarding animal sightings, including rats, and <a href="https://www.kaggle.com/new-york-city/nyc-rat-sightings/data">it makes this data publicly available</a>.</p>
<p>For this second redesign assignment, you will use <strong>R and <code>ggplot</code></strong> to tell an interesting story hidden in the data. You can recreate one of these ugly, less-than-helpful graphs, or create a new story by looking at other variables in the data:</p>
<figure class="fullwidth">
<img src="/images/assignment/rat_examples.png" alt="Bad example 1" />
</figure>
<p>Here’s what you need to do:</p>
<ol style="list-style-type: decimal">
<li><strong>Download</strong> New York City’s database of rat sightings since 2010:<span><label for="sn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="marginnote"> <img src="https://media.giphy.com/media/3rgXBqQT75uvb1V8Os/giphy.gif" alt="Shredder" /><br />
<br />
</span></span> <a href="/data/Rat_Sightings.csv"><i class="fa fa-download" aria-hidden="true"></i> NYC Rat Sightings</a>. Place this in a folder named <code>data</code> in an RStudio project.<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">As always, you’ll probably need to right click on this link and choose “Save link as…”, since your browser will want to display it as text. The data was originally <a href="https://www.kaggle.com/new-york-city/nyc-rat-sightings/data">uploaded by the City of New York to Kaggle</a>, and is provided with a public domain license.<br />
<br />
</span></span></li>
<li><strong>Summarize</strong> the data somehow. The raw data has more than 100,000 rows, which means you’ll need to aggregate the data. Consider looking at the number of sightings per borough, per year, per dwelling type, etc., or a combination of these, like the change in the number sightings across the 5 boroughs between 2010 and 2016.</li>
<li><strong>Create</strong> an appropriate visualization based on the data you summarized.</li>
<li><strong>Write</strong> a memo (no word limit) explaining your process. I’m specifically looking for a discussion of the following:
<ul>
<li>What was wrong with the original graphic (if you’re fixing one of the original figures)?</li>
<li>What story are you telling with your new graphic?</li>
<li>How did you apply the principles of CRAP?</li>
<li>How did you apply Alberto Cairo’s five qualities of great visualizations?</li>
</ul></li>
<li><strong><a href="mailto:andrew_heiss@byu.edu">E-mail me</a></strong> the following outputs:
<ul>
<li>A PDF of your memo with your final code and graphic embedded in it.<span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">You can approach this in a couple different ways—you can write the memo and then include the full figure and code at the end, <a href="https://rud.is/b/2017/09/18/mapping-fall-foliage-with-sf/">similar to this blog post</a>, or you can write the memo in an incremental way, describing the different steps of creating the figure, ultimately arriving at a clean final figure, <a href="https://rudeboybert.github.io/fivethirtyeight/articles/bechdel.html">like this blog post</a>.<br />
<br />
</span></span> This means you’ll need to do all your coding in an R Markdown file and embed your code in chunks.</li>
<li>A standalone PNG version of your graphic<span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote">Use <code>ggsave(plot_name, filename = &quot;blah.png&quot;, width = XX, height = XX)</code><br />
<br />
</span></span></li>
<li>A standalone PDF version of your graphic<span><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="sidenote">Use <code>ggsave(plot_name, filename = &quot;blah.pdf&quot;, width = XX, height = XX)</code><br />
<br />
</span></span></li>
</ul></li>
</ol>
<p>You will be graded based on how you use R and <code>ggplot</code>, how well you apply the principles of CRAP, <em>The Truthful Art</em>, and <em>Effective Data Visualization</em>, and how appropriate the graph is for the data and the story you’re telling. I will use <a href="/assignment/rubrics/redesign2_rubric.pdf">this rubric</a> to grade the final product.<span><label for="sn-6" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="marginnote"> <a href="/assignment/rubrics/redesign2_rubric.pdf"><img src="/images/rubrics/redesign2_rubric.png" alt="Example rubric for redesign 2" /></a><br />
<br />
</span></span> For this assignment, I am less concerned with detailed graphic design principles—select appropriate colors, change fonts if you’re brave, and choose a nice <code>ggplot</code> theme and perhaps make a few adjustments like moving the legend around (<code>theme(legend.position = &quot;bottom&quot;)</code>) or other things you find with <code>ggThemeAssist</code>.</p>
<p><strong>The assignment is due by midnight on Monday, October 2</strong>.</p>
<p>This assignment is more code-intensive than the first redesign assignment, but you have enough R skills to do this (really really). Help abounds—work in groups,<span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">Though your assignments have to be turned in individually…<br />
<br />
</span></span> consult with your classmates, <em>meet with me</em>, and search Google. You can do this, and you’ll hopefully feel like a dataviz wizard/witch when you’re done.</p>
<p>I’ve provided some starter code below. A couple comments about it:</p>
<ul>
<li>By default, <code>read_csv()</code> treats cells that are empty or “NA” as missing values. This rat dataset uses “N/A” to mark missing values, so we need to add that as a possible marker of missingness (hence <code>na = c(&quot;&quot;, &quot;NA&quot;, &quot;N/A&quot;)</code>)</li>
<li>To make life easier, I’ve renamed some of the key variables you might work with. You can rename others if you want.</li>
<li>I’ve also created a few date-related variables (<code>sighting_year</code>, <code>sighting_month</code>, <code>sighting_day</code>, and <code>sighting_weekday</code>). You don’t have to use them, but they’re there if you need them.<span><label for="sn-8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="sidenote">The functions that create these, like <code>year()</code> and <code>wday()</code> are part of the <code>lubridate</code> library.<br />
<br />
</span></span></li>
<li>The date/time variables are formatted like <code>04/03/2017 12:00:00 AM</code>, which R is not able to automatically parse as a date when reading the CSV file. You can use the <code>mdy_hms()</code> function in the <code>lubridate</code> library to parse dates that are structured as “month-day-year-hour-minute.”<span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote">There are also a bunch of other iterations of this function, like <code>ymd()</code>, <code>dmy()</code>, etc., for other date formats.<br />
<br />
</span></span></li>
<li>There’s one row with an unspecified borough, so I filter that out.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)

rats_raw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/Rat_Sightings.csv&quot;</span>, <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;N/A&quot;</span>))

<span class="co"># If you get an arror that says &quot;All formats failed to parse. No formats</span>
<span class="co"># found&quot;, it&#39;s because the mdy_hms function couldn&#39;t parse the date. The date</span>
<span class="co"># variable *should* be in this format: &quot;04/03/2017 12:00:00 AM&quot;, but in some</span>
<span class="co"># rare instances, it might load without the seconds as &quot;04/03/2017 12:00 AM&quot;.</span>
<span class="co"># If there are no seconds, use mdy_hm() instead of mdy_hms().</span>
rats_clean &lt;-<span class="st"> </span>rats_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">created_date =</span> <span class="st">`</span><span class="dt">Created Date</span><span class="st">`</span>,
         <span class="dt">location_type =</span> <span class="st">`</span><span class="dt">Location Type</span><span class="st">`</span>,
         <span class="dt">borough =</span> Borough) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="kw">mdy_hm</span>(created_date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sighting_year =</span> <span class="kw">year</span>(created_date),
         <span class="dt">sighting_month =</span> <span class="kw">month</span>(created_date),
         <span class="dt">sighting_day =</span> <span class="kw">day</span>(created_date),
         <span class="dt">sighting_weekday =</span> <span class="kw">wday</span>(created_date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">abbr =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(borough <span class="op">!=</span><span class="st"> &quot;Unspecified&quot;</span>)</code></pre></div>
<p>You’ll summarize the data with functions from <code>dplyr</code>, including stuff like <code>count()</code>, <code>arrange()</code>, <code>filter()</code>, <code>group_by()</code>, <code>summarize()</code>, and <code>mutate()</code>. Here are some examples of ways to summarize the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See the count of rat sightings by weekday</span>
rats_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(sighting_weekday)

<span class="co"># Assign a table to an object to use it in a plot</span>
rats_by_weekday &lt;-<span class="st"> </span>rats_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(sighting_weekday, sighting_year)

<span class="co"># geom_bar() will try to calculate the count for you by default. Here we</span>
<span class="co"># already have the count, so we have to specify that the statistic we care</span>
<span class="co"># about in the bar chart is &quot;identity&quot;, or the actual variable that&#39;s there</span>
<span class="co"># already.</span>
<span class="co">#</span>
<span class="co"># coord_flip() flips the plot so that the weekdays show up on the y-axis. This</span>
<span class="co"># messes with the ordering, though, and puts Saturday at the top. You can</span>
<span class="co"># reverse the levels of the weekday category with the fct_rev function in the</span>
<span class="co"># forcats package, which provides a bunch of functions for working with</span>
<span class="co"># factors.</span>
<span class="kw">ggplot</span>(rats_by_weekday, <span class="kw">aes</span>(<span class="dt">x =</span> forcats<span class="op">::</span><span class="kw">fct_rev</span>(sighting_weekday), <span class="dt">y =</span> n)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sighting_year)

<span class="co"># See the count of rat sightings by weekday and borough</span>
rats_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(sighting_weekday, borough, sighting_year)

<span class="co"># An alternative to count() is to specify the groups with group_by() and then</span>
<span class="co"># be explicit about how you&#39;re summarizing the groups, such as calculating the</span>
<span class="co"># mean, standard deviation, or number of observations (we do that here with</span>
<span class="co"># `n()`).</span>
rats_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(sighting_weekday, borough) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</code></pre></div>
